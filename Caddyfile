{$DOMAIN} {
    root * /app/public
    php_server
    file_server

    encode gzip zstd

    # Security headers
    header {
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        Referrer-Policy "no-referrer-when-downgrade"
        X-XSS-Protection "1; mode=block"
        Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;"
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    }

    # Block access to sensitive files
    @sensitive path_regexp sensitive ^/(?:\.env|wp-config\.php|wp-config-sample\.php|readme\.html|license\.txt)$
    respond @sensitive 404

    # Deny direct access to PHP files in uploads (prevents code execution in uploads)
    @uploads_php path_regexp uploads_php ^/wp-content/uploads/.*\.php$
    respond @uploads_php 404

    # Optional: restrict xmlrpc if not used
    @xmlrpc path /xmlrpc.php
    respond @xmlrpc 403
}
